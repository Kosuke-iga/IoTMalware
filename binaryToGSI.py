import numpy as np
import matplotlib.pyplot as plt
import glob
import re
from PIL import Image
files=glob.glob('/Users/kosukeigarashi/Desktop/IoTPOT/random4000_iot_mal_20161002-20171002/*')
#files=glob.glob('/Users/kosukeigarashi/Desktop/malware/ELF-3/*')
#files=glob.glob('/Users/kosukeigarashi/Desktop/benign/elfUbt/*')
def is_out_of_range(arr, x ):
    try:
        arr[x]
    except IndexError:
        return True
    else:
        return False
#for i in range(10):
    #file=files[i]
for file in files:
    if 'json' in file:
        continue
    if 'jpg' in file:
        continue
    binary = file
    output='{file}.jpg'.format(file=file)
    cnt=0
    
    with open(binary, mode='rb') as f:
        s = f.read()
    #if len(s) < 64*64:
     #   continue
    pixels = np.empty((int(len(s)/64),64),dtype=np.uint8)
    print(len(s))
    for h in range(int(len(s)/64)):
        for w in range(64):
            pixels[h][w]=int(format(s[cnt], '08b'),2)
            cnt+=1


    try:
        Image.fromarray(pixels).save(output)
    except:
        print('-------------------------------------------------------------------------------------------------')
        print(file)
        print('-------------------------------------------------------------------------------------------------')
    